const preview = document.getElementById("preview");
const markdownSource = document.getElementById("markdown-source");

function render() {
  const markdown = markdownSource.textContent;
  preview.innerHTML = marked.parse(markdown);
  addCopyButtons();
}

function addCopyButtons() {
  // Find all code blocks (pre tags) generated by marked
  const preElements = preview.querySelectorAll('pre');
  
  preElements.forEach((pre) => {
    // Create a container to hold the pre and the button
    const container = document.createElement('div');
    container.className = 'code-block-container';
    
    // Insert the container before the pre and move the pre inside it
    pre.parentNode.insertBefore(container, pre);
    container.appendChild(pre);

    // Create the copy button
    const button = document.createElement('button');
    button.className = 'copy-button';
    button.innerText = 'Copy';

    // Add click event listener to copy text to clipboard
    button.addEventListener('click', () => {
      const code = pre.textContent; // Get the raw text inside the pre/code block
      navigator.clipboard.writeText(code).then(() => {
        button.innerText = 'Copied!';
        setTimeout(() => {
          button.innerText = 'Copy';
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    });

    container.appendChild(button);
  });
}

render();
